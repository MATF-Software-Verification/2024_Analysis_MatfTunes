# Project Analysis Report — MatfTunes

## About this report

## 1. Author
- **Name:** Anja Čolić  
- **Course:** Software Verification  
- **Academic Year:** 2024/2025  
- **Faculty:** Faculty of Mathematics, University of Belgrade  

---

## 2. Project Overview
- **Project name:** MatfTunes  
- **Repository:** [MatfTunes GitLab](https://gitlab.com/matf-bg-ac-rs/course-rs/projects-2023-2024/MatfTunes)  
- **Commit hash analyzed:** `ee68f33973bf1141c0e8e77be43bd7491eb92818`
---

## 3. Tools Used

1. **cppcheck** 
2. **clang-tidy**
3. **valgrind - memcheck**
4. **valgrind - massif**

## Tool 1: Cppcheck – Static Code Analysis
**Tool purpose**:
Cppcheck is a static analysis tool designed to detect potential logical, performance, and stylistic issues in C++ code without executing it.
It performs deep parsing of source files to identify code patterns that may indicate bugs, poor practices, or inefficiencies.\
**Scope of analysis**:
The analysis was executed over the entire source directory: matftunes/MatfTunes/src/\
**Command and configuration**:
The following command was run automatically using the script cppcheck/run_cppcheck.sh: 
<pre>cppcheck --enable=all --inconclusive --std=c++17 --force \
--cppcheck-build-dir=cppcheck_build matftunes/MatfTunes/src/ </pre>
**Cppcheck was configured to perform**:
1. Full rule set analysis (--enable=all)
2. Inconclusive and performance checks
3. XML report generation for HTML visualization
4. Force analysis across all translation units

**Reports generated**:
1. cppcheck/results/cppcheck_<date>.txt 
2. cppcheck/results/cppcheck_<date>.xml 
3. cppcheck/html-report/index.html – HTML

**Results:**

Cppcheck found no critical memory or logical errors, confirming that the MatfTunes project is robust and well-written.
The issues reported were mainly stylistic or best-practice related:

- Code clarity: Several functions could benefit from adding the override keyword to clarify inheritance behavior.
- Safety: Constructors should be marked explicit to avoid unintended implicit conversions.
- Performance: Initialization within the constructor body can be moved to initialization lists.
- Maintainability: A few unused functions and variables were detected and can be safely removed.

Below is a screenshot of the generated HTML analysis report showing a subset of identified issues:
<img width="1573" height="745" alt="CppCheckScreenshot" src="https://github.com/user-attachments/assets/37d79123-3ff3-4621-a1c8-4b4fda2fac59" />


**Conclusions**:
1. No severe logical or memory errors were found.
2. Minor issues related to code readability, parameter consistency, and unused functions.
Recommendations:
1. Mark overridden functions explicitly with override.
2. Initialize all member variables in constructors.
3. Remove unused code fragments to improve maintainability.

Overall, the Cppcheck analysis demonstrates that the MatfTunes codebase is well-structured and maintainable, with only minimal refinements suggested for code style and clarity.

## Tool 2: Clang-Tidy – Static Code Quality and Style Analysis
**Tool purpose**:
To verify code style, structure, and C++ best practices.
The analysis was performed on the entire MatfTunes source code, using the compile_commands.json file generated by CMake.\
**Scope of analysis**:
Entire source directory: matftunes/MatfTunes/src/.\
**Command and configuration**:
Executed using the script clang-tidy/run_clang_tidy.sh: 
<pre>cmake -S ../matftunes/MatfTunes -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
 clang-tidy *.cpp --warnings-as-errors=* --export-fixes=results/clang_tidy_fixes.yaml -p build > results/clang_tidy_report.txt </pre>

<img width="935" height="476" alt="ScriptStartingScreenshot" src="https://github.com/user-attachments/assets/69668b20-7d66-4c25-8f71-fc5a4ee48f17" />


**Clang-Tidy checks were configured to**:
1. Treat all warnings as errors (--warnings-as-errors=*)
2. Export suggested code fixes to clang_tidy_fixes.yaml

**Reports generated**:
1. clang-tidy/results/clang_tidy_report.txt
2. clang-tidy/results/clang_tidy_fixes.yaml

**Results summary**:
Clang-Tidy successfully performed a structural analysis of the project, identifying several categories of issues:
- Missing generated headers:
Some files (ui_*.h) were not found because Qt automatically generates them during the build process.
This is expected and does not indicate actual source errors.
- Memory management warning:
Potential memory leak detected in songlibrary.cpp, where the dynamically allocated Song object may not be freed if early return occurs.
- General observations:
1. Several header inclusions can be simplified.
2. Some functions could benefit from const correctness and override usage.

**Conclusions**:
1. Clang-Tidy confirms the code follows modern C++ standards.
2. Most issues are minor and stylistic (missing headers generated by Qt).
3. The significant finding was a potential memory leak, which should be reviewed.

**Recommendations**:
1. Regenerate missing ui_*.h files through Qt Creator before full static analysis.
2. Review the memory management logic in SongLibrary::addSong().
3. Apply suggested automatic fixes from clang_tidy_fixes.yaml to improve code consistency and style.

## Tool 3: Valgrind – Dynamic Memory Analysis
**Tool purpose**:
Valgrind (specifically the Memcheck tool) is used for dynamic memory analysis, detecting memory leaks, invalid reads/writes, and use of uninitialized memory during runtime.
**Scope of analysis**:
The analysis was executed over the entire source directory: matftunes/MatfTunes/build/Desktop-Debug/MatfTunes\
**Command and configuration**:
The following command was run automatically using the script memcheck/run_memcheck.sh: 
<pre> cvalgrind --tool=memcheck --leak-check=full --show-leak-kinds=all \
         --track-origins=yes --verbose \
         --log-file=results/memcheck_<date>.log ../../matftunes/MatfTunes/build/Desktop-Debug/MatfTunes </pre>

**Valgrind was configured to perform**:

1. Full leak detection (--leak-check=full)
2. Reporting of all leak categories (--show-leak-kinds=all)
3. Tracking of uninitialized memory origins (--track-origins=yes)
4. Logging into a timestamped report file

**Reports generated**: valgrind/memcheck/results/memcheck_<date>.log


**Results**:
SUMMARY LEAK:
<img width="869" height="224" alt="LeakSummaryScreenshot" src="https://github.com/user-attachments/assets/496dca89-8188-4aa4-9048-7e68c7c55777" />

The Valgrind analysis revealed no critical memory corruption or major leaks.
Detected issues are primarily Qt-managed allocations and minor custom leaks, representing normal runtime behavior for GUI applications.
The MatfTunes project demonstrates stable memory handling.

**Conclusions**:
1. Critical leaks: None detected — no major unfreed heap allocations directly related to project code.
2. Warnings: Most uninitialized value warnings come from internal Qt behavior
3. Custom code issues: Possible improvement points in MainWindow::addSongButton() (line 276).
Minor leaks in the SongLibrary component where newly created Song objects may not be deleted.\

**Recommendations**:
1. Use smart pointers for dynamically allocated objects.
2. Review MainWindow and SongLibrary destructors for manual deallocation of heap-allocated entities.

## Tool 4: Valgrind Massif – Memory Profiling
**Tool purpose**:
Valgrind Massif is a memory profiling tool that measures and visualizes heap memory usage over time during program execution.
Unlike memcheck, which focuses on detecting memory leaks and invalid accesses, Massif tracks how much memory is allocated dynamically and helps identify functions or modules responsible for the largest memory consumption peaks.
**Scope of analysis**:
The analysis was executed over the entire source directory: matftunes/MatfTunes/build/Desktop-Debug/MatfTunes\
**Command and configuration**:
The following command was run automatically using the script massif/run_massif.sh: 
<pre> valgrind --tool=massif --time-unit=B --stacks=yes \
  --massif-out-file=./results/massif_2025-10-20_17-16.out "$PROJECT_PATH" </pre>

**Massif was executed with the following configuration:**:
1. --tool=massif → memory profiling (heap usage)
2. --time-unit=B → time measured in bytes allocated
3. --stacks=yes → includes stack allocations
4. Output file: valgrind/massif/results/massif_<date>.out
5. Visualized using ms_print and Massif Visualizer

**Reports generated**:
1. massif/results/massif_2025-10-20_17-16.out – raw profiling output
2. Massif Visualizer graph (Massif Visualizer tool) – graphical visualization of memory usage snapshots over time


**Results**:
Massif Visualizer graph:
<img width="1827" height="1049" alt="MassifScreenshot" src="https://github.com/user-attachments/assets/ed8cbdaa-bedd-487a-a854-aca7ccb867fb" />


The Massif output and visual graph indicate the following:

- Total number of snapshots: 54
- Peak memory usage: 22.6 MiB (snapshot #25)
- Main allocation sources:g_malloc() from the GLib library and Qt-related allocations (mostly QImage and QWidget initialization)
- Memory usage grows gradually during application startup — particularly when graphical interface components and image resources are being loaded.
- After reaching the peak at snapshot #25, the total heap size decreases and stabilizes, showing that memory is properly released once initialization is complete.
- The report does not indicate memory leaks, but rather normal allocation patterns typical for Qt GUI applications.

**Conclusions**:
1. No memory leaks were detected — all major memory allocations correspond to normal GUI initialization and image processing.
2. Peak heap usage (22.6 MiB) is within expected bounds for a multimedia desktop application.
3. The memory footprint remains stable throughout execution, demonstrating proper memory management.


**Recommendations**:
 - For future scalability testing, re-run Massif with larger media libraries to ensure heap growth remains stable.


## Repository Structure

<pre> 
.
├── clang-tidy
│   ├── build
│   ├── llvm.sh
│   ├── results
│   │   ├── clang_tidy_fixes.yaml
│   │   └── clang_tidy_report.txt
│   ├── run_clang_tidy.sh
│   └── ScriptStartingScreenshot.png
├── cppcheck
│   ├── cppcheck_build
│   ├── CppCheckScreenshot.png
│   ├── html-report
│   │   ├── 0.html
│   │   ├── 10.html
│   │   ├── 11.html
│   │   ├── 12.html
│   │   ├── 1.html
│   │   ├── 2.html
│   │   ├── 3.html
│   │   ├── 4.html
│   │   ├── 5.html
│   │   ├── 6.html
│   │   ├── 7.html
│   │   ├── 8.html
│   │   ├── 9.html
│   │   ├── index.html
│   │   ├── stats.html
│   │   └── style.css
│   ├── results
│   │   ├── cppcheck_2025-10-20_00-02.txt
│   │   ├── cppcheck_2025-10-20_00-04.txt
│   │   ├── cppcheck_2025-10-20_00-07.txt
│   │   └── cppcheck_2025-10-20_00-07.xml
│   └── run_cppcheck.sh
│   ├── modules
│   │   └── matftunes
├── .github
│   └── workflows
│       ├── gate.yml
│       └── tickets.yml
├── .gitignore
├── .gitmodules
├── matftunes
├── ProjectAnalysisReport.md
├── project_structure.txt
├── README.md
└── valgrind
    ├── massif
    │   ├── MassifScreenshot.png
    │   ├── results
    │   │   └── massif_2025-10-20_17-16.out
    │   ├── run_massif.sh
    │   └── TerminalScreenshot.png
    └── memcheck
        ├── LeakSummaryScreenshot.png
        ├── results
        │   └── memcheck_2025-10-20_02-35.log
        ├── run_memcheck.sh

</pre>

